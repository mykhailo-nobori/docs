{"version":3,"file":"hydrateAsync.js","sourceRoot":"","sources":["../../src/csr/hydrateAsync.tsx"],"names":[],"mappings":";AAAA;;;GAGG;AAEH,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAC5C,OAAO,EAAE,WAAW,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AAE9D,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAKzC;;;;;;;;GAQG;AACH,MAAM,UAAU,YAAY,CAAC,EAC3B,cAAc,EACd,WAAW,GAAG,EAAE,EAChB,KAAK,GAAG,EAAE,EACV,UAAU,EACV,oBAAoB;AACpB,8CAA8C;AAC9C,OAAO,EACP,OAAO,GACW;IAClB,MAAM,EAAE,OAAO,EAAE,GAAG,OAAO,IAAI,EAAE,CAAC;IAElC,MAAM,CAAC,SAAS,EAAE,YAAY,CAAC,GAAG,QAAQ,CAA+B;QACvE,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,eAAO;QAC1C,GAAG,EAAE,EAAE;KACR,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,KAAK,UAAU,UAAU;YACvB,6BAA6B;YAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;YAEzD,IAAI,CAAC;gBACH,MAAM,UAAU,GAAG,MAAM,QAAQ,CAAC,cAAc,EAAE;oBAChD,UAAU,EAAE;wBACV,OAAO;wBACP,gBAAgB;qBACjB;oBACD,WAAW;oBACX,KAAK;iBACN,CAAC,CAAC;gBAEH,YAAY,CAAC,UAAU,CAAC,CAAC;YAC3B,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,YAAY,CAAC;oBACX,KAAK,EAAE,KAAc;iBACtB,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAED,UAAU,EAAE,CAAC;IACf,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,IAAI,OAAO,IAAI,SAAS,EAAE,CAAC;QACzB,OAAO;YACL,OAAO,EAAE,cAAK,SAAS,EAAC,WAAW,GAAG;YACtC,GAAG,EAAE,EAAE;YACP,KAAK,EAAE,SAAS,CAAC,KAAK;SACvB,CAAC;IACJ,CAAC;IAED,MAAM,OAAO,GAAG,UAAU,CAAC,CAAC,CAAC;IAC3B,+FAA+F;IAC/F,KAAC,WAAW,IAAC,UAAU,EAAE,UAAU,EAAE,oBAAoB,EAAE,oBAAoB,YAC7E,KAAC,SAAS,CAAC,OAAO,KAAG,GACT,CACf,CAAC,CAAC,CAAC;IACF,+FAA+F;IAC/F,KAAC,SAAS,CAAC,OAAO,KAAG,CACtB,CAAC;IAEF,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,SAAS,CAAC,GAAG,EAAE,CAAC;AACzC,CAAC","sourcesContent":["/**\n * Copyright (c) @talatkuyuk AKA @ipikuka\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { useEffect, useState } from \"react\";\nimport { MDXProvider, useMDXComponents } from \"@mdx-js/react\";\n\nimport { runAsync } from \"../lib/run.js\";\nimport type { RunResult } from \"../lib/types.js\";\n\nimport type { HydrateAsyncProps, HydrateResult } from \"./types.js\";\n\n/**\n * This is experimental and proof for NOT WORKING in pages directory\n *\n * \"run\"s the javascript code in the compiled source, and\n * returns the <Content /> component whether or not wrapped with the MDXProvider\n * in the domain of client side rendering (csr).\n *\n * the hydration process occurs asynchronously in the useEffect so as to import modules in the compiled source.\n */\nexport function hydrateAsync({\n  compiledSource,\n  frontmatter = {},\n  scope = {},\n  components,\n  disableParentContext,\n  // two options below are for only hydrateAsync\n  options,\n  loading,\n}: HydrateAsyncProps): HydrateResult {\n  const { baseUrl } = options ?? {};\n\n  const [runResult, setRunResult] = useState<RunResult | { error: Error }>({\n    Content: loading ? loading : () => <div />,\n    mod: {},\n  });\n\n  useEffect(() => {\n    async function getContent() {\n      // to see loading state a bit\n      await new Promise((resolve) => setTimeout(resolve, 500));\n\n      try {\n        const runResult_ = await runAsync(compiledSource, {\n          mdxOptions: {\n            baseUrl,\n            useMDXComponents,\n          },\n          frontmatter,\n          scope,\n        });\n\n        setRunResult(runResult_);\n      } catch (error) {\n        setRunResult({\n          error: error as Error,\n        });\n      }\n    }\n\n    getContent();\n  }, []);\n\n  if (\"error\" in runResult) {\n    return {\n      content: <div className=\"mdx-empty\" />,\n      mod: {},\n      error: runResult.error,\n    };\n  }\n\n  const content = components ? (\n    // wrap the Content with the MDXProvider in order to customize the standard markdown components\n    <MDXProvider components={components} disableParentContext={disableParentContext}>\n      <runResult.Content />\n    </MDXProvider>\n  ) : (\n    // no need to wrap the Content with the MDXProvider since there is no custom component provided\n    <runResult.Content />\n  );\n\n  return { content, mod: runResult.mod };\n}\n"]}