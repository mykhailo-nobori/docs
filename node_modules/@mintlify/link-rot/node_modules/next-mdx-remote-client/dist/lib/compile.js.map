{"version":3,"file":"compile.js","sourceRoot":"","sources":["../../src/lib/compile.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,OAAO,EAAE,OAAO,IAAI,UAAU,EAA4C,MAAM,aAAa,CAAC;AAG9F,OAAO,kBAAkB,EAAE,EAAE,IAAI,EAAE,MAAM,uBAAuB,CAAC;AAGjE,OAAO,EAAE,uBAAuB,EAAE,MAAM,WAAW,CAAC;AAEpD;;;;;GAKG;AACH,SAAS,qBAAqB,CAAC,UAA0B,EAAE;IACzD,MAAM,EAAE,UAAU,GAAG,EAAE,EAAE,cAAc,EAAE,cAAc,EAAE,GAAG,OAAO,CAAC;IAEpE,MAAM,mBAAmB,GAAG,IAAI,CAAC,CAAC,cAAc,IAAI,QAAQ,EAAE,cAAc,IAAI,QAAQ,CAAC,CAAC,CAAC;IAE3F,MAAM,aAAa,GAAkB;QACnC,GAAG,CAAC,UAAU,CAAC,aAAa,IAAI,EAAE,CAAC;QACnC,CAAC,kBAAkB,EAAE,mBAAmB,CAAC;KAC1C,CAAC;IAEF,OAAO;QACL,GAAG,UAAU;QACb,aAAa;QACb,YAAY,EAAE,eAAe;KAC9B,CAAC;AACJ,CAAC;AAED;;;;GAIG;AACH,MAAM,CAAC,KAAK,UAAU,OAAO,CAAC,KAAY,EAAE,OAAwB;IAClE,IAAI,CAAC;QACH,MAAM,cAAc,GAAG,MAAM,UAAU,CAAC,KAAK,EAAE,qBAAqB,CAAC,OAAO,CAAC,CAAC,CAAC;QAE/E,gBAAgB;QAChB,IAAI,OAAO,EAAE,mBAAmB,EAAE,CAAC;YACjC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;QACtC,CAAC;QAED,4DAA4D;QAE5D,OAAO;YACL,cAAc;SACf,CAAC;IACJ,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,MAAM,uBAAuB,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;IACtD,CAAC;AACH,CAAC","sourcesContent":["/**\n * Copyright (c) @talatkuyuk AKA @ipikuka\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { compile as compileMDX, type CompileOptions as CompileMDXOptions } from \"@mdx-js/mdx\";\nimport type { VFile } from \"vfile\";\nimport type { PluggableList } from \"unified\";\nimport remarkMdxRemoveEsm, { clsx } from \"remark-mdx-remove-esm\";\n\nimport type { CompileOptions, CompileResult } from \"./types.js\";\nimport { createFormattedMDXError } from \"./util.js\";\n\n/**\n * composes an opinionated version of CompileOptions of the \"@mdx-js/mdx\"\n *\n * @param options CompileOptions\n * @returns CompileOptions of the \"@mdx-js/mdx\"\n */\nfunction composeCompileOptions(options: CompileOptions = {}): CompileMDXOptions {\n  const { mdxOptions = {}, disableImports, disableExports } = options;\n\n  const mdxRemoveEsmOptions = clsx([disableExports && \"export\", disableImports && \"import\"]);\n\n  const remarkPlugins: PluggableList = [\n    ...(mdxOptions.remarkPlugins || []),\n    [remarkMdxRemoveEsm, mdxRemoveEsmOptions],\n  ];\n\n  return {\n    ...mdxOptions,\n    remarkPlugins,\n    outputFormat: \"function-body\",\n  };\n}\n\n/**\n * compiles the vfile source via the compile of the \"@mdx-js/mdx\".\n *\n * returns the compiled source.\n */\nexport async function compile(vfile: VFile, options?: CompileOptions): Promise<CompileResult> {\n  try {\n    const compiledSource = await compileMDX(vfile, composeCompileOptions(options));\n\n    // for debugging\n    if (options?.debugCompiledSource) {\n      console.log(String(compiledSource));\n    }\n\n    // await new Promise((resolve) => setTimeout(resolve, 500));\n\n    return {\n      compiledSource,\n    };\n  } catch (error: any) {\n    throw createFormattedMDXError(error, String(vfile));\n  }\n}\n"]}