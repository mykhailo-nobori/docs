{"version":3,"file":"hydrateLazy.js","sourceRoot":"","sources":["../../src/csr/hydrateLazy.tsx"],"names":[],"mappings":";AAAA;;;GAGG;AAEH,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AACrD,OAAO,EAAE,WAAW,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AAE9D,OAAO,6BAA6B,CAAC;AACrC,OAAO,EAAE,OAAO,EAAE,MAAM,eAAe,CAAC;AAIxC;;;;;;GAMG;AACH,MAAM,UAAU,WAAW,CAAC,EAC1B,cAAc,EACd,WAAW,GAAG,EAAE,EAChB,KAAK,GAAG,EAAE,EACV,UAAU,EACV,oBAAoB,GACP;IACb,MAAM,CAAC,eAAe,EAAE,kBAAkB,CAAC,GAAG,QAAQ,CAAC,OAAO,MAAM,KAAK,WAAW,CAAC,CAAC;IAEtF,oCAAoC;IAEpC,sEAAsE;IACtE,0FAA0F;IAC1F,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,OAAO,GAAG,MAAM,CAAC,mBAAmB,CAAC,GAAG,EAAE;YAC9C,kBAAkB,CAAC,IAAI,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;QACH,OAAO,GAAG,EAAE,CAAC,MAAM,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;IAClD,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE;QAC3C,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,OAAO,CAAC,cAAc,EAAE;gBACrC,WAAW;gBACX,KAAK;gBACL,UAAU,EAAE;oBACV,gBAAgB;iBACjB;aACF,CAAC,CAAC;YAEH,OAAO,EAAE,GAAG,MAAM,EAAE,CAAC;QACvB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,cAAK,SAAS,EAAC,WAAW,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,KAAK,EAAE,KAAc,EAAE,CAAC;QAC1F,CAAC;IACH,CAAC,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC;IAErB,IAAI,CAAC,eAAe,EAAE,CAAC;QACrB,OAAO;YACL,uEAAuE;YACvE,OAAO,EAAE,cAAK,uBAAuB,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,EAAE,wBAAwB,SAAG;YAClF,GAAG,EAAE,EAAE;SACR,CAAC;IACJ,CAAC;IAED,MAAM,OAAO,GAAG,UAAU,CAAC,CAAC,CAAC;IAC3B,+FAA+F;IAC/F,KAAC,WAAW,IAAC,UAAU,EAAE,UAAU,EAAE,oBAAoB,EAAE,oBAAoB,YAC7E,KAAC,OAAO,KAAG,GACC,CACf,CAAC,CAAC,CAAC;IACF,+FAA+F;IAC/F,KAAC,OAAO,KAAG,CACZ,CAAC;IAEF,2FAA2F;IAC3F,OAAO,EAAE,OAAO,EAAE,wBAAM,OAAO,GAAO,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC;AACvD,CAAC","sourcesContent":["/**\n * Copyright (c) @talatkuyuk AKA @ipikuka\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { MDXProvider, useMDXComponents } from \"@mdx-js/react\";\n\nimport \"./idle-callback-polyfill.js\";\nimport { runSync } from \"../lib/run.js\";\n\nimport type { HydrateResult, HydrateProps } from \"./types.js\";\n\n/**\n * \"run\"s the javascript code in the compiled source, and\n * returns the <Content /> component whether or not wrapped with the MDXProvider\n * in the domain of client side rendering (csr).\n *\n * the hydration process occurs lazily.\n */\nexport function hydrateLazy({\n  compiledSource,\n  frontmatter = {},\n  scope = {},\n  components,\n  disableParentContext,\n}: HydrateProps): HydrateResult {\n  const [isReadyToRender, setIsReadyToRender] = useState(typeof window === \"undefined\");\n\n  // console.log({ isReadyToRender });\n\n  // since lazy, the mdx content is hydrated inside requestIdleCallback,\n  // allowing the page to get to interactive quicker, but the mdx content to hydrate slower.\n  useEffect(() => {\n    const request = window.requestIdleCallback(() => {\n      setIsReadyToRender(true);\n    });\n    return () => window.cancelIdleCallback(request);\n  }, []);\n\n  const { Content, mod, error } = useMemo(() => {\n    try {\n      const result = runSync(compiledSource, {\n        frontmatter,\n        scope,\n        mdxOptions: {\n          useMDXComponents,\n        },\n      });\n\n      return { ...result };\n    } catch (error) {\n      return { Content: () => <div className=\"mdx-empty\" />, mod: {}, error: error as Error };\n    }\n  }, [compiledSource]);\n\n  if (!isReadyToRender) {\n    return {\n      // If not ready to render, return an empty div to preserve SSR'd markup\n      content: <div dangerouslySetInnerHTML={{ __html: \"\" }} suppressHydrationWarning />,\n      mod: {},\n    };\n  }\n\n  const content = components ? (\n    // wrap the Content with the MDXProvider in order to customize the standard markdown components\n    <MDXProvider components={components} disableParentContext={disableParentContext}>\n      <Content />\n    </MDXProvider>\n  ) : (\n    // no need to wrap the Content with the MDXProvider since there is no custom component provided\n    <Content />\n  );\n\n  // since lazy, need to wrap with a div to preserve the same markup structure that was SSR'd\n  return { content: <div>{content}</div>, mod, error };\n}\n"]}